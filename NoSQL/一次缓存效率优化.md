背景

​	按部门统计2018年的红包情况需求如下：

 - 计算整个部门收到红包个数
 - 计算收到红包个数最多的子部门

- 计算部门下面，收到红包个数top3的员工



  数据规模：60w+ 的企业，每家企业下面可能有上百个部门，每个部门下面有子部门及子孙部门，每个部门下面还有人员。



### 最开始的方案

方案：利用sql，将所有员工的红包数据统计到一张临时表中，以年为单位，数据量减少到11w，并且建立索引。然后只需要扫描该表的数据，进行计算。、

效果：fs耗时时长 120s，如果按60w家企业的量，需要834天才能刷完全网数据



### 方案演进一

使用进程内缓存，将DB查询过的数据，加载到缓存中，下次再需要该数据，直接从缓存里面拿



### 方案演进二

由于DB中临时表的数据已经较少了，11w+，并且一条数据占用内存也很少（试验约40k），所以把该表的数据全部加载到缓存里面，直接从缓存中拿数据进行计算。

（1）内存存取数据，计算速度大大提升，fs耗时32秒

（2）总体数据量占内容约6M，可以接受的范围





### 